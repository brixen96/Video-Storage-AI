üéØ Goals for the Perfect Video Player

Studio-grade playback quality and responsiveness (fast start, smooth seek)

Full technical visibility (codec, timeline, frames) for a power-user workflow

Deep integration with your library: performers, tags, scenes, and AI features

Robustness: hardware acceleration, multi-track support, subtitle handling, error recovery

Excellent UX: thumbnails on scrub, keyboard-first controls, small-footprint UI in dark theme

üß± High-level architecture

Frontend player component: VideoPlayer.vue (Composition API). Handles UI, controls, keyboard, UI overlays, thumbnails, waveform display, and communicates with backend for heavy tasks.

Playback engine:

Primary: browser native <video> with Media Source Extensions (MSE) where possible (fast, accessible).

Fallback / advanced: a native wrapper / desktop binding that can use FFmpeg + libavcodec for formats the browser struggles with (for Electron/WIN build) ‚Äî or use a custom player element that feeds decoded frames via WebCodecs if you go that route later.

When on Windows with NVIDIA, optionally use hardware accel via system codec (DXVA) or via a local decoding service.

Backend helpers (Go):

Thumbnail generation & preview trimming (FFmpeg/ffmpeg-worker)

Frame-accurate seek server endpoints (returns thumbnails or small MP4 segments)

Transcript / scene detection jobs

Communication:

WebSocket for live events (playback logging, live OCR/AI events, progress)

REST endpoints for metadata, saves, bookmarks, snapshots

üéõ UI / Controls (core)

Visible controls (minimal / compact by default; expand on hover or keyboard).

Play / Pause

Stop

Seek bar ‚Äî clickable + draggable; shows preview thumbnails while scrubbing (generated by FFmpeg, cached)

Current time / Duration (HH:MM:SS.ms)

Frame stepping ‚Üê / ‚Üí (step 1 frame, step 10 frames)

Speed control (0.25x, 0.5x, 0.75x, 1x, 1.25x, 1.5x, 2x, custom)

Volume + mute + audio device selector

Fullscreen / Windowed / Picture-in-picture

Aspect ratio toggle (Fit / Fill / Stretch / 16:9 crop)

Subtitles / Captions menu (select track, load external .srt / WebVTT)

Audio tracks menu (select audio stream, show language if present)

Chapters dropdown (auto-generated from AI scene detection or .chapters file)

Loop / A‚ÄìB loop (set A and B points)

Bookmark (create scene bookmark with timestamp + thumbnail + note)

Screenshot (export frame as PNG or copy to clipboard)

Save clip (trim selection to new preview clip via server-side FFmpeg job)

Toggle overlays: metadata overlay, waveform, histogram, subtitle burn-in preview

Context menu (right-click): open file location, copy path, fetch metadata, analyze scene, add tag, export clip

üß© Advanced Playback Features

Preview Thumbnails on Scrub

Pre-generate thumbnails at configurable interval (every 1s, 2s or adaptive).

Serve via /api/videos/{id}/preview-thumb?t=12.345 or as a sprite with JSON index.

Frame-accurate Seek & Frame Stepping

Use FFmpeg to generate keyframe index and nearest frame offsets.

Provide server endpoint that returns a short frame-accurate segment or a single frame image for instant step.

High-quality Trimming & Clip Export

Provide UI to select in/out points; POST job to backend to export a trimmed .mkv using stream copy (fast) or re-encode (if requested).

Multi-audio & Subtitle Management

Detect tracks via ffprobe.

Let user pick audio + subtitle tracks; allow loading external subtitle files and saving associations to DB.

Waveform & Audio Scrubber

Precompute audio waveform data (small JSON) for the timeline to enable visual navigation and show loudness peaks.

Optionally show spectrogram (on demand) computed by backend.

Color / HDR & LUT Support

Show color profile info; allow a simple color LUT preview (if implemented later).

Note: full HDR correct playback requires OS & display support ‚Äî show metadata and warn if limited.

Slow-motion & Frame Interpolation

Offer smooth slow-motion by frame blending (server-side or client-side using WebGL shaders). Optional advanced feature.

Playback Analytics

Track play events (start, stop, seek, percent viewed) and report to the Live App Activity Monitor. Useful for recommendations and popularity metrics.

Scene Detection & Auto-chapters

Run detection job: scene cut detection, face change, audio silence. Save scene timestamps and make them clickable in timeline.

Face / Performer Highlights

If scene detection provides face embeddings or detections, overlay performer badges where they appear and link to Performer Page.

AI Tools in Player

On-demand ‚ÄúAnalyze this clip‚Äù that triggers: auto-tagging, transcript (speech-to-text), keyframe extraction, and scene suggestions. Results shown in a side panel.

üé® UI Layout & UX details

Default compact control bar at bottom, dark translucent background.

Hover or keyboard expands advanced toolbar (speed, tracks, clip tools).

Timeline has two layers: top layer for thumbnail previews, lower layer for waveform + chapters markers.

Chapters / Scene markers are clickable; hovering shows a small preview + snippet title.

Bookmarks rendered on timeline as small pins; clicking opens the bookmark card (image + note).

Right-click position-aware context menu (same as Performer/Video pages for consistency).

Mobile / narrow view: simplified controls (Play, Seek, Speed, Fullscreen, Subtitle).

üîó API endpoints (player-relevant)

GET /api/videos/{id}/info ‚Äî full metadata + streams + chapters + scenes + thumbnails index

GET /api/videos/{id}/thumbnail?t=12.345 ‚Äî get a thumbnail image for time t

GET /api/videos/{id}/thumbsprite & /api/videos/{id}/thumbsprite.json ‚Äî sprite + index (for efficient scrub)

GET /api/videos/{id}/frame?t=xx.xxx ‚Äî single frame PNG (frame-accurate request)

POST /api/videos/{id}/clip ‚Äî create clip (body: start,end,method) returns job id / download link

POST /api/videos/{id}/analyze ‚Äî run AI jobs: scene detection, face detection, transcript ‚Äî returns job id

GET /api/jobs/{jobid} ‚Äî job status & results

WS /ws/events ‚Äî real-time updates: job progress, player telemetry, Live App Activity Monitor integration

üßæ Data & DB integration

Video doc stores: scenes[] (start, end, title, thumbnail, performers[]), chapters[], bookmarks[], waveform_path, thumbsprite_info.

Scene object example:

{
"start": 12.345,
"end": 52.678,
"title": "Scene 1 ‚Äî Beach",
"thumbnail": "/api/videos/{id}/thumbnail?t=12.345",
"detected_performers": ["performerId1"]
}

Store job results (analysis) separate with reference ids so re-run is possible.

‚öôÔ∏è Performance & caching

Thumbnail & sprite cache on disk with naming derived from file mtime+hash to bust.

Waveform JSON persisted and only regenerated if file changes.

Pre-generate lightweight preview clips (10‚Äì20s) for hover use if the original is heavy.

Lazy loading: don‚Äôt load preview clips unless card is in viewport or hovered.

Worker pool for FFmpeg jobs (bounded concurrency).

Use ffprobe to quickly extract stream info and keyframe positions for fast seeks.

‚ôø Accessibility & Keyboard

Keyboard map: Space play/pause, ‚Üê/‚Üí seek small step, Shift+‚Üê/‚Üí big step, . , frame step, F fullscreen, S speed menu, B set bookmark, / focus search.

Proper ARIA roles for controls; visible focus outlines; captions support; color contrast compliant.

üîí Security & Safety

File operations require confirmation and optional undo buffer for deletes (soft-delete).

Validate and sanitize external subtitle and metadata content.

API keys for external services (AdultDataLink, STT services) stored server-side only.

‚úÖ Implementation roadmap (practical)

MVP (2‚Äì4 sprints)

VideoPlayer.vue basic playback with HTML5 <video> + controls, timeline, thumbnails on hover (simple sprite), fullscreen, speed, subtitles.

Backend FFmpeg thumbnail sprite generation & /thumbnail endpoint.

Frame stepping + frame image endpoint.

Phase 2 (adds power features) 4. Waveform generation & waveform timeline. 5. Clip export and bookmark system. 6. Chapters & scene markers (scene detection job). 7. Multi-track audio & subtitle management.

Phase 3 (AI & polish) 8. Face/performer overlay & auto-linking. 9. Transcript/STT + search inside audio. 10. Advanced slow-motion/frame interpolation and color preview tools. 11. Telemetry & integration with Live App Activity Monitor.

üîß Component outline (Vue)

VideoPlayer.vue ‚Äî main wrapper + props: videoId, src, previews, chapters, scenes.

PreviewTimeline.vue ‚Äî thumbnails + waveform + markers.

ControlBar.vue ‚Äî play/pause, seek, speed, volume, subtitles.

PlayerToolbar.vue ‚Äî clip, bookmark, analyze, screenshot.

PlayerAPI.ts ‚Äî helper for endpoints, websocket hooks, job polling.

Final notes ‚Äî UX philosophy

Keep defaults simple for non-power users: easy play, nice thumbnails, fast start. Expose power features progressively (hover, advanced toolbar, right-click, keyboard). Cache aggressively and move expensive work to background jobs so playback stays snappy.
